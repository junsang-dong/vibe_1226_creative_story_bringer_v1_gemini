---
name: 이미지 생성 가이드 기능 추가
overview: 스토리 편집 단계에 이미지 생성 가이드 입력 기능을 추가하고, 이미지 생성 시 이 가이드를 프롬프트에 자동으로 포함하도록 구현합니다.
todos:
  - id: "1"
    content: Story 타입에 imageGenerationGuide 필드 추가
    status: completed
  - id: "2"
    content: StoryEditor에 이미지 생성 가이드 입력 섹션 추가 및 onUpdateStory prop 추가
    status: completed
    dependencies:
      - "1"
  - id: "3"
    content: EditPage에서 StoryEditor에 onUpdateStory prop 전달
    status: completed
    dependencies:
      - "2"
  - id: "4"
    content: ImageGenerator에서 이미지 생성 시 가이드를 프롬프트에 포함
    status: completed
    dependencies:
      - "1"
  - id: "5"
    content: i18n에 이미지 생성 가이드 관련 번역 추가 (선택사항)
    status: completed
---

# 이미지 생성 가이드 기능 구현

## 개요

스토리 편집 단계에 "이미지 생성 가이드" 섹션을 추가하여, 모든 이미지 생성에 공통적으로 적용될 가이드(예: "말 풍선 생성 금지")를 설정할 수 있도록 합니다. 설정된 가이드는 이미지 생성 시 프롬프트에 자동으로 포함됩니다.

## 구현 단계

### 1. 데이터 모델 확장

**파일**: `src/types/story.ts`

- `Story` 인터페이스에 `imageGenerationGuide?: string` 필드 추가
- 선택적 필드로 설정하여 기존 스토리와의 호환성 유지

### 2. StoryEditor 컴포넌트 수정

**파일**: `src/components/StoryEditor/StoryEditor.tsx`

- `StoryEditorProps`에 `onUpdateStory?: (updates: Partial<Story>) => void` prop 추가
- 컴포넌트 상단에 "이미지 생성 가이드" 섹션 추가
    - 텍스트 영역으로 가이드 입력 받기
    - 예시 텍스트: "예: 말 풍선 생성 금지, 텍스트 포함하지 않기 등"
    - 가이드가 변경되면 `onUpdateStory` 호출하여 스토리 업데이트

### 3. EditPage 수정

**파일**: `src/pages/EditPage.tsx`

- `StoryEditor`에 `onUpdateStory` prop 전달
- `updateStory` 함수를 사용하여 이미지 생성 가이드 업데이트 처리

### 4. 이미지 생성 시 가이드 적용

**파일**: `src/components/ImageGenerator/ImageGenerator.tsx`

- `handleTextSelect` 함수에서 이미지 생성 프롬프트 생성 시
- `story.imageGenerationGuide`가 있으면 프롬프트에 포함
- 형식: `[기존 프롬프트]. ${story.imageGenerationGuide}`

**파일**: `src/services/geminiService.ts`

- `generateImage` 함수의 `fullPrompt` 생성 시
- 옵션으로 전달받은 가이드를 프롬프트에 포함하도록 수정 (필요시)

### 5. i18n 지원 (선택사항)

**파일**: `src/utils/i18n.ts`

- "이미지 생성 가이드" 관련 번역 키 추가 (ko, en, ja)
- UI 텍스트 다국어 지원

## 데이터 흐름

```
사용자 입력 (StoryEditor)
  ↓
onUpdateStory 호출
  ↓
updateStory (EditPage)
  ↓
Story.imageGenerationGuide 저장
  ↓
이미지 생성 시 (ImageGenerator)
  ↓
story.imageGenerationGuide를 프롬프트에 포함
  ↓
geminiService.generateImage 호출
```

## UI 레이아웃

StoryEditor 컴포넌트 구조:

```
[스토리 편집 제목]
[이미지 생성 가이드 섹션] ← 새로 추가
  - 제목: "이미지 생성 가이드"
  - 텍스트 영역 (textarea)
  - 예시 텍스트 표시
[챕터 목록]
[새 챕터 추가 섹션]
```

## 주의사항

- 기존 스토리 데이터와의 호환성 유지 (선택적 필드)
- 가이드가 없어도 이미지 생성이 정상 작동해야 함
- 프롬프트 길이 제한을 고려하여 가이드 길이 제한 고려 (선택사항)